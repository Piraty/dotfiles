#!/bin/sh -e
# git-tag-shortlog TITLE [COMMIT] - create an annotated, signed tag, including shortlog since previous tag

TITLE="$1"
COMMIT="${2:-HEAD}"

_lastref="$(git describe --tags --abbrev=0 || git log --format='%H' | tail -n1)"
# if no tag was found, fallback to first commit
: "${_lastref:="$(git log --format='%H' | tail -n1)"}"
_shortlog="$(git shortlog ${_lastref}..${COMMIT})"

_msg="$TITLE

$_shortlog"

git tag \
	-s \
	-a \
	--edit \
	-m "$_msg" \
	"$TITLE" "$COMMIT"
