#!/bin/sh
# git-tag-shortlog TITLE [REF] - create an annotated, signed tag, including shortlog since previous tag

set -eu

TITLE="$1"
REF="${2:-HEAD}"

_lastref="$(git describe --tags --abbrev=0 "$REF" 2>/dev/null || git log --format='%H' "$REF" | tail -n1)"
_shortlog="$(git shortlog "$_lastref".."$REF")"

_msg="$TITLE

$_shortlog"

git tag \
	-s \
	-a \
	--edit \
	-m "$_msg" \
	"$TITLE" "$REF"
